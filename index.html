<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CleanMayor | Tienda Premium</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3c72;
            --primary-light: #2a5298;
            --accent: #4CAF50;
            --bg: #f8fafc;
            --text: #1e293b;
            --text-light: #64748b;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.5;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 3rem 1rem;
            text-align: center;
            clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .search-container {
            max-width: 600px;
            margin: 0 auto 2rem;
            padding: 0 1rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1.5rem;
            border-radius: 2rem;
            border: none;
            box-shadow: var(--shadow);
            font-size: 1rem;
            outline: none;
            transition: box-shadow 0.3s;
        }

        .search-input:focus {
            box-shadow: var(--shadow-lg);
        }

        .mode-container {
            max-width: 400px;
            margin: -2rem auto 2rem;
            position: relative;
            z-index: 10;
        }

        .mode-toggle {
            background: var(--white);
            padding: 0.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            gap: 0.5rem;
        }

        .mode-toggle button {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            background: transparent;
            font-weight: 600;
            color: var(--text-light);
            transition: all 0.3s;
        }

        .mode-toggle button.active {
            background: var(--primary);
            color: white;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem 5rem;
        }

        .catalog {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .product {
            background: var(--white);
            border-radius: 1.25rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            display: flex;
            flex-direction: column;
        }

        .product:hover {
            transform: translateY(-5px);
        }

        .product h3 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .product p {
            color: var(--text-light);
            font-size: 0.9rem;
            flex-grow: 1;
            margin-bottom: 1rem;
        }

        .price {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
        }

        .qty-controls {
            display: flex;
            align-items: center;
            background: #f1f5f9;
            border-radius: 0.5rem;
            padding: 0.25rem;
        }

        .qty-controls button {
            background: var(--white);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 0.4rem;
            cursor: pointer;
            font-weight: bold;
        }

        .qty-controls input {
            width: 40px;
            text-align: center;
            border: none;
            background: transparent;
            font-weight: 600;
        }

        .add-btn {
            background: var(--primary);
            color: white;
            padding: 0.9rem;
            width: 100%;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            margin-top: 1rem;
            font-weight: 600;
        }

        .cart-float {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 1rem 2rem;
            border-radius: 2rem;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(30, 60, 114, 0.4);
            display: none;
            align-items: center;
            gap: 1rem;
            z-index: 100;
            border: none;
        }

        .delivery-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: var(--shadow-lg);
            display: none;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .input-premium {
            width: 100%;
            padding: 0.85rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            font-family: inherit;
        }

        .radio-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .radio-box {
            flex: 1;
            border: 2px solid #e2e8f0;
            padding: 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            text-align: center;
        }

        .radio-box.selected {
            border-color: var(--primary);
            background: #eff6ff;
        }

        .hidden {
            display: none;
        }

        .loader-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 640px) {
            .catalog {
                grid-template-columns: 1fr;
            }

            .radio-group {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div id="loader" class="loader-container">
        <div class="spinner"></div>
        <p>Procesando pedido...</p>
    </div>

    <div class="header">
        <h1>CleanMayor</h1>
        <p>Limpieza Profesional | Mayorista y Minorista</p>
    </div>

    <div class="search-container">
        <input type="text" id="search" class="search-input" placeholder=" Buscar productos..."
            oninput="renderCatalog()">
    </div>

    <div class="mode-container">
        <div class="mode-toggle">
            <button id="btn-minorista" class="active" onclick="setMode('minorista')">Minorista</button>
            <button id="btn-mayorista" onclick="setMode('mayorista')">Mayorista (Min $25.000)</button>
        </div>
    </div>

    <div class="main-container">
        <div id="catalog" class="catalog">
            <p style="grid-column: 1/-1; text-align: center;">Cargando productos...</p>
        </div>

        <div id="delivery-options" class="delivery-card">
            <h3> Finalizar Pedido</h3>
            <br>
            <div class="form-group">
                <label class="form-label">Nombre y Apellido *</label>
                <input type="text" id="client-name" class="input-premium" placeholder="Escribe tu nombre completo">
            </div>

            <div class="form-group">
                <label class="form-label">WhatsApp de contacto *</label>
                <input type="tel" id="client-phone" class="input-premium" placeholder="Ej: 3525550761">
            </div>

            <div class="form-label">驴C贸mo quieres tu pedido?</div>
            <div class="radio-group">
                <div class="radio-box" id="box-retiro" onclick="setDelivery('retiro')">Retiro en Local</div>
                <div class="radio-box" id="box-domicilio" onclick="setDelivery('domicilio')">Env铆o a Domicilio</div>
            </div>

            <div id="address-fields" class="hidden">
                <div class="form-group">
                    <label class="form-label">Direcci贸n de entrega</label>
                    <input type="text" id="address" class="input-premium" placeholder="Calle, n煤mero, barrio...">
                </div>
                <div class="form-group">
                    <label class="form-label">Notas adicionales</label>
                    <textarea id="notes" class="input-premium" rows="2"
                        placeholder="Indicaciones para el repartidor..."></textarea>
                </div>
            </div>

            <button class="add-btn" style="background: var(--accent);" onclick="submitOrder()">
                CONFIRMAR POR WHATSAPP
            </button>
            <button class="add-btn" style="background: #e2e8f0; color: var(--text);" onclick="hideCheckout()">
                SEGUIR COMPRANDO
            </button>
        </div>
    </div>

    <button id="cart-float" class="cart-float" onclick="showCheckout()">
        <span> Finalizar Pedido</span>
        <span id="cart-total" style="font-weight: 700;">$0</span>
    </button>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbmmyshiZHDhgdkD-2It5SPFmUorDAQAuRZjFJIE4wg3Wg136LgETJj66Voy83y5pZVhg/exec";
        const WHATSAPP = "5493525550761";

        let dbProducts = [];
        let cart = {};
        let currentMode = 'minorista';
        let deliveryMode = '';

        document.addEventListener('DOMContentLoaded', fetchProducts);

        async function fetchProducts() {
            try {
                const res = await fetch(SCRIPT_URL);
                const json = await res.json();
                if (json.status === 'success') {
                    dbProducts = json.data;
                    renderCatalog();
                }
            } catch (e) {
                document.getElementById('catalog').innerHTML = '<p>Error cargando productos. Revisa tu conexi贸n.</p>';
            }
        }

        function renderCatalog() {
            const container = document.getElementById('catalog');
            const searchTerm = document.getElementById('search').value.toLowerCase();
            container.innerHTML = '';

            const filtered = dbProducts.filter(p => p.name.toLowerCase().includes(searchTerm));

            filtered.forEach((p, index) => {
                const price = currentMode === 'minorista' ? p.priceMinorista : p.priceMayorista;
                const card = document.createElement('div');
                card.className = 'product';
                card.innerHTML = `
                    <h3>${p.name}</h3>
                    <p>${p.description || 'Calidad CleanMayor'}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                        <div class="price">$${Number(price).toLocaleString('es-AR')}</div>
                        <div class="qty-controls">
                            <button onclick="updateQty('${p.name}', -1)">-</button>
                            <input type="number" value="${cart[p.name] || 0}" readonly>
                            <button onclick="updateQty('${p.name}', 1)">+</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function updateQty(name, delta) {
            cart[name] = Math.max(0, (cart[name] || 0) + delta);
            if (cart[name] === 0) delete cart[name];
            renderCatalog();
            updateCartUI();
        }

        function updateCartUI() {
            let total = 0;
            let count = 0;
            Object.keys(cart).forEach(name => {
                const p = dbProducts.find(item => item.name === name);
                const price = currentMode === 'minorista' ? p.priceMinorista : p.priceMayorista;
                total += cart[name] * price;
                count += cart[name];
            });
            document.getElementById('cart-total').textContent = `$${total.toLocaleString('es-AR')}`;
            document.getElementById('cart-float').style.display = count > 0 ? 'flex' : 'none';
        }

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn-minorista').classList.toggle('active', mode === 'minorista');
            document.getElementById('btn-mayorista').classList.toggle('active', mode === 'mayorista');
            renderCatalog();
            updateCartUI();
        }

        function showCheckout() {
            document.getElementById('catalog').style.display = 'none';
            document.querySelector('.search-container').style.display = 'none';
            document.getElementById('delivery-options').style.display = 'block';
            document.getElementById('cart-float').style.display = 'none';
        }

        function hideCheckout() {
            document.getElementById('catalog').style.display = 'grid';
            document.querySelector('.search-container').style.display = 'block';
            document.getElementById('delivery-options').style.display = 'none';
            updateCartUI();
        }

        function setDelivery(type) {
            deliveryMode = type;
            document.getElementById('box-retiro').classList.toggle('selected', type === 'retiro');
            document.getElementById('box-domicilio').classList.toggle('selected', type === 'domicilio');
            document.getElementById('address-fields').classList.toggle('hidden', type !== 'domicilio');
        }

        async function submitOrder() {
            const name = document.getElementById('client-name').value;
            const phone = document.getElementById('client-phone').value;
            if (!name || !phone) return alert("Completa tu nombre y tel茅fono");
            if (!deliveryMode) return alert("Elige un m茅todo de entrega");

            document.getElementById('loader').style.display = 'flex';

            const data = {
                numeroPedido: "PED-" + Date.now(),
                clienteNombre: name,
                clienteTelefono: phone,
                productos: Object.keys(cart).map(n => ({ product: n, quantity: cart[n] })),
                modo: currentMode.toUpperCase(),
                totalItems: Object.values(cart).reduce((a, b) => a + b, 0),
                tipoEntrega: deliveryMode === 'retiro' ? 'Retiro' : 'Domicilio',
                direccion: document.getElementById('address').value,
                referencias: '',
                notas: document.getElementById('notes').value,
                invoiceMethod: 'WhatsApp'
            };

            // Env铆o por formulario silencioso
            const iframe = document.createElement('iframe');
            iframe.name = 'hidden_iframe';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);

            const form = document.createElement('form');
            form.method = 'POST';
            form.action = SCRIPT_URL;
            form.target = 'hidden_iframe';
            const input = document.createElement('input');
            input.name = 'payload';
            input.value = JSON.stringify(data);
            form.appendChild(input);
            document.body.appendChild(form);
            form.submit();

            setTimeout(() => {
                const msg = ` *NUEVO PEDIDO #${data.numeroPedido}*\n\nHola! Soy ${name}.\nEste es mi pedido:\n` +
                    data.productos.map(p => `- ${p.product} (x${p.quantity})`).join('\n') +
                    `\n\n*Entrega:* ${data.tipoEntrega}` + (data.direccion ? `\n*Direcci贸n:* ${data.direccion}` : '');

                window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`, '_blank');
                location.reload();
            }, 2000);
        }
    </script>
</body>

</html>